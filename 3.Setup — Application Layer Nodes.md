# Pre-Lab Setup — Application Layer Nodes (Web Server & Proxy Logs)

Before analysis, instructors must prepare **application layer evidence** for students. These logs simulate activity at the web application and proxy layer, providing context for host and network forensic correlation.

---

## 1. Web Server Node (Apache Example)

### Step A — Environment Setup
- Use an Ubuntu/Debian VM.
- Install Apache2:
  ```bash
  sudo apt update && sudo apt install -y apache2
  ```
- Verify service:
  ```bash
  systemctl status apache2
  ```

### Step B — Enable Logging
- Default logs: `/var/log/apache2/access.log` and `error.log`.
- Ensure `CustomLog` and `ErrorLog` directives are enabled in `/etc/apache2/sites-enabled/000-default.conf`.

### Step C — Generate Activity
- Normal traffic:
  ```bash
  curl http://localhost/
  curl http://localhost/index.html
  ```
- Suspicious activity simulation:
  ```bash
  curl -X POST -d "file=data" http://localhost/upload.php
  ab -n 50 -c 5 http://localhost/index.html   # ApacheBench stress test
  ```
- Optional: craft unusual URIs with long parameters to mimic tunneling:
  ```bash
  curl "http://localhost/page.php?data=$(openssl rand -hex 50)"
  ```

### Step D — Collect Logs
- Copy logs into lab directory:
  ```bash
  sudo cp /var/log/apache2/access.log ~/lab_logs/web_access.log
  sudo cp /var/log/apache2/error.log ~/lab_logs/web_error.log
  ```
- Hash logs:
  ```bash
  sha256sum ~/lab_logs/web_*.log
  ```

**Deliverables:** `web_access.log`, `web_error.log`.

---

## 2. Proxy Node (Squid Example)

### Step A — Install Squid Proxy
```bash
sudo apt update && sudo apt install -y squid
```

### Step B — Configure Basic Logging
- Default access log: `/var/log/squid/access.log`.
- Ensure in `/etc/squid/squid.conf`:
  ```
  access_log /var/log/squid/access.log squid
  ```

### Step C — Generate Activity Through Proxy
- Configure browser or curl to use proxy:
  ```bash
  export http_proxy="http://localhost:3128"
  curl http://example.com
  curl -x http://localhost:3128 http://malicious.example.com
  ```
- Simulate suspicious activity (odd User-Agent):
  ```bash
  curl -A "EvilScanner/1.0" -x http://localhost:3128 http://example.com
  ```

### Step D — Collect Proxy Logs
- Copy logs:
  ```bash
  sudo cp /var/log/squid/access.log ~/lab_logs/proxy_access.log
  ```
- Hash logs:
  ```bash
  sha256sum ~/lab_logs/proxy_access.log
  ```

**Deliverable:** `proxy_access.log`.

---

## 3. Packaging for Students
Organize evidence bundle:
```
app-logs/
  web_access.log
  web_error.log
  proxy_access.log
```
Include hash manifest.

---

## Verification Checklist (Instructor)
- [ ] Apache installed, logs generated with normal + suspicious requests.
- [ ] Squid installed, proxy access log contains benign + anomalous requests.
- [ ] All logs copied into `app-logs/` and hashed.
- [ ] Evidence packaged with manifest for student distribution.

---

✅ Once these logs are collected, students will use them in **Task 1 (Endpoint / Application Logs)** and **Task 4 (Middleware Correlation)** during the lab.
