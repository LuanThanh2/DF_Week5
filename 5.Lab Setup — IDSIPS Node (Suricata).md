# Pre-Lab Setup — IDS/IPS Node (Suricata)

This guide explains how instructors can prepare **IDS/IPS evidence** using Suricata. Suricata is an open-source IDS/IPS that produces JSON logs (EVE format) suitable for correlation with pcaps and host/middleware logs.

---

## 1. Environment Setup

### Option A — Linux VM
- Use Ubuntu/Debian VM.
- Install Suricata:
  ```bash
  sudo add-apt-repository ppa:oisf/suricata-stable
  sudo apt update
  sudo apt install -y suricata
  ```
- Verify:
  ```bash
  suricata --build-info
  ```

### Option B — Windows Workstation (via WSL)
- Enable WSL (Ubuntu-22.04 recommended).
- Inside WSL:
  ```bash
  sudo add-apt-repository ppa:oisf/suricata-stable
  sudo apt update
  sudo apt install -y suricata
  ```
- Verify with `suricata --build-info`.

---

## 2. Configure Suricata

### Rule Sets
- Suricata uses rule files (`.rules`) to detect threats.
- Recommended: [ET Open Ruleset](https://rules.emergingthreats.net/open/suricata/).
- Download and place into `/etc/suricata/rules/`:
  ```bash
  sudo wget https://rules.emergingthreats.net/open/suricata/emerging.rules.tar.gz
  sudo tar -xzf emerging.rules.tar.gz -C /etc/suricata/rules/
  ```

### Update Suricata Config
- File: `/etc/suricata/suricata.yaml`
- Ensure outputs include JSON (EVE):
  ```yaml
  outputs:
    - eve-log:
        enabled: yes
        filetype: regular
        filename: eve.json
        types:
          - alert
          - dns
          - http
          - tls
          - flow
  ```

---

## 3. Generate Evidence Logs

### Step A — Run Against Sample PCAP
```bash
mkdir -p ~/lab_logs/suri
suricata -r ~/week1/pcaps/attack.pcap -l ~/lab_logs/suri -k none
```

- `-r` → offline mode, reads pcap.
- `-l` → log directory.
- `-k none` → skip checksum validation (for lab).

### Step B — Inspect Logs
- Alerts:
  ```bash
  jq 'select(.event_type=="alert")' ~/lab_logs/suri/eve.json | head
  ```
- DNS events:
  ```bash
  jq 'select(.event_type=="dns")' ~/lab_logs/suri/eve.json | head
  ```
- HTTP events:
  ```bash
  jq 'select(.event_type=="http")' ~/lab_logs/suri/eve.json | head
  ```

### Step C — Hash and Package
```bash
sha256sum ~/lab_logs/suri/eve.json > ~/lab_logs/suri/hash_manifest.txt
```

**Deliverables:** `eve.json`, `hash_manifest.txt`.

---

## 4. Packaging for Students
Organize evidence:
```
ids/
  suricata/
    eve.json
    hash_manifest.txt
```

---

## Verification Checklist (Instructor)
- [ ] Suricata installed and verified with `--build-info`.
- [ ] EmergingThreats rules downloaded and configured.
- [ ] Suricata ran on `attack.pcap` and produced `eve.json`.
- [ ] Alerts, DNS, HTTP, TLS, and flow records present.
- [ ] Hash manifest created and evidence packaged.

---

✅ Once Suricata evidence is prepared, students can use it in **Task 5 (IDS Validation & Blind Spots)** during the Week 1 lab.
