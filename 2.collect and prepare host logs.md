# Pre-Lab Setup — Host Nodes (Evidence Sources)

Before the analysis workstation can be used, students need **host node evidence** from both Windows and Linux machines. These host logs form the foundation for correlation with network captures and middleware logs.

This guide explains how to **collect and prepare host logs** so that they can be distributed to students as sample evidence.

---

## 1. Windows Host Node

### Requirements
- Windows 10/11 VM (can be joined to a domain or standalone).
- Sysinternals Sysmon installed and configured.

### Step A — Enable Audit Policies
Run PowerShell as Administrator:
```powershell
# Enable logon auditing
auditpol /set /subcategory:"Logon" /success:enable /failure:enable

# Enable process creation auditing
auditpol /set /subcategory:"Process Creation" /success:enable
```

### Step B — Install and Configure Sysmon
1. Download Sysmon: [https://docs.microsoft.com/sysinternals/downloads/sysmon](https://docs.microsoft.com/sysinternals/downloads/sysmon)
2. Install with a recommended config (SwiftOnSecurity config is widely used):
   ```powershell
   sysmon64.exe -accepteula -i sysmonconfig.xml
   ```
   - Captures process creation, network connections, file creation, DNS queries.

### Step C — Generate Activity (for lab dataset)
- Log in/out multiple times (creates Event ID 4624/4625).
- Run browsers and command-line tools to create network events.
- Optional: simulate benign and suspicious commands (e.g., PowerShell web requests).

### Step D — Export Logs
- Security Log:
  ```powershell
  wevtutil epl Security C:\lab_logs\Security.evtx
  ```
- Sysmon Log:
  ```powershell
  wevtutil epl Microsoft-Windows-Sysmon/Operational C:\lab_logs\Sysmon.evtx
  ```
- Hash the files:
  ```powershell
  Get-FileHash C:\lab_logs\*.evtx -Algorithm SHA256
  ```

**Deliverables:** `Security.evtx`, `Sysmon.evtx` (with hashes).

---

## 2. Linux Host Node

### Requirements
- Ubuntu/Debian VM (other distros OK).
- Syslog and auditd enabled.

### Step A — Enable and Configure Auditd
```bash
sudo apt update && sudo apt install -y auditd
```
Rules (append to `/etc/audit/rules.d/audit.rules`):
```bash
-w /etc/passwd -p wa -k passwd_changes
-w /etc/sudoers -p wa -k sudoers_changes
-a always,exit -F arch=b64 -S execve -k exec_log
```
Reload:
```bash
sudo service auditd restart
```

### Step B — Generate Activity
- SSH into the VM with multiple user accounts.
- Use `sudo` and basic admin commands.
- Run curl/wget to generate network traffic.

### Step C — Collect Logs
- System logs:
  ```bash
  sudo cp /var/log/syslog ~/lab_logs/syslog
  sudo cp /var/log/auth.log ~/lab_logs/auth.log
  ```
- Audit logs:
  ```bash
  sudo ausearch --start today --raw > ~/lab_logs/auditd.log
  ```
- Hash:
  ```bash
  sha256sum ~/lab_logs/*
  ```

**Deliverables:** `syslog`, `auth.log`, `auditd.log`.

---

## 3. Packaging for Students
- Combine Windows and Linux evidence into a bundle:
  ```
  host-logs/
    windows/Security.evtx
    windows/Sysmon.evtx
    linux/syslog
    linux/auth.log
    linux/auditd.log
  ```
- Provide hashes in a manifest.

---

## Verification Checklist (Instructor)
- [ ] Windows Security.evtx and Sysmon.evtx collected, hashed.
- [ ] Linux syslog, auth.log, auditd.log collected, hashed.
- [ ] Sample activity present (logons, processes, network events).
- [ ] Evidence packaged into `host-logs/` folder for distribution.

---

✅ Once these logs are collected and packaged, students can use them in **Task 1 (Endpoint / Application Logs)** during the lab.
